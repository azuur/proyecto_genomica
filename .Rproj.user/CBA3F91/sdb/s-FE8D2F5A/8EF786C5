{
    "collab_server" : "",
    "contents" : "source(\"functions.R\")\nsource(\"load.R\")\n\n\n\n\n######PRIMERO, QUITAR MICROARREGLOS FEOS######\n\n\n#Generamos boxplot\n#boxplot(Ecoli_data[,2:51],las=2)\n#boxplot(Ecoli_data[,52:101],las=2)\n#boxplot(Ecoli_data[,102:151],las=2)\n#boxplot(Ecoli_data[,152:201],las=2)\n#boxplot(Ecoli_data[,202:214],las=2)\n#Están especialmente feas las muestras 4, 211, 212. (únicas con cuartil_3 < 5)\n\n#Generamos dendrograma para ver qué quitar\n#data_dendr <- Ecoli_data[,-1] %>% `rownames<-`(1:nrow(Ecoli_data[,-1])) %>% `colnames<-`(1:ncol(Ecoli_data[,-1]))\n#dd= dist2(log2(data_dendr))\n#diag(dd)=0\n#set.seed(1032)\n#dd.row<-as.dendrogram(hclust(as.dist(dd)))\n#row.ord<-order.dendrogram(dd.row) #organizacion\n#legend=list(top=list(fun=dendrogramGrob,args=list(x=dd.row,side=\"top\")))\n#lp=levelplot(dd[row.ord,rev(row.ord)],xlab=\"\", ylab=\"\",legend=legend,  scales=list(x=list(rot=90)))\n#lp\n#No se ve mucho, pero por ahí hay un par muy poco correlacionadas con las demás. Miremos cuáles.\n#which(apply(dd,MARGIN = 1,FUN = median)>0.22)\n#La 210 también es relativamente diferente de las demás.\n\n#Por lo anterior, quitamos las muestras 4, 210, 211, y 212\ndatos <- Ecoli_data %>% dplyr::select(-c(5,211,212,213))\n\n\n\n\n\n\n\n####### AHORA, RESUMEN SONDAS GENES #####\n\n#Nombres de filas y columnas\nrownames(datos) <- datos[,1]\ncolnames(correspondencia)[1] <- colnames(datos)[1] <- \"ProbeSet.id\"\n#Correspondencia (Resumen)\ndatos <- datos %>% full_join(correspondencia, by = \"ProbeSet.id\") %>% dplyr::select(-ProbeSet.id) %>%\n  group_by(Gene.Symbol) %>% summarize_all(max) %>% drop_na(Gene.Symbol) %>% as.data.frame()\n#Nombres de filas y columnas\nrownames(datos) <- datos$Gene.Symbol\ndatos <- datos[,-1]\n\n\n\n\n\n\n\n####### AHORA, MIRAMOS SI QUITAR GENES CON POCA VARIABILIDAD  #####\n\nsds <- apply(datos,MARGIN = 1,FUN = sd)\n#boxplot(sds)\nmeans <- apply(datos, MARGIN = 1,FUN = mean)\n#boxplot(means)\ncvs <- sds/means\nboxplot(cvs)\n\n#ggplot(data=cvs,aes(x=.)) + geom_density(alpha=0.01)\n\ncheck_pv<-which(cvs<quantile(cvs,0.001))\ncheck_data_pv <- t(datos[check_pv,]) %>% as.data.frame() %>% \n  `colnames<-`(paste0(\"Pv\",1:length(check_pv))) %>% mutate(Muestra = 1:dim(datos)[2]) %>%\n  reshape2::melt(id.vars = \"Muestra\")\n#ggplot(data=check_data_pv,aes(x=value,fill=variable,color=variable)) + geom_density(alpha =0.1) +\n#  facet_grid(rows=vars(variable))\n\ncheck_mv<-which(cvs<=quantile(cvs,0.152) & cvs>quantile(cvs,0.151))\ncheck_data_mv <- t(datos[check_mv,]) %>% as.data.frame() %>% \n  `colnames<-`(paste0(\"Mv\",1:length(check_mv))) %>% mutate(Muestra = 1:dim(datos)[2]) %>%\n  reshape2::melt(id.vars = \"Muestra\")\n#ggplot(data=check_data_mv,aes(x=value,fill=variable,color=variable)) + geom_density(alpha =0.1) +\n#  facet_grid(rows=vars(variable))\n\ncheck_lv<-which(cvs<=quantile(cvs,0.691) & cvs>quantile(cvs,0.69))\ncheck_data_lv <- t(datos[check_lv,]) %>% as.data.frame() %>% \n  `colnames<-`(paste0(\"Lv\",1:length(check_lv))) %>% mutate(Muestra = 1:dim(datos)[2]) %>%\n  reshape2::melt(id.vars = \"Muestra\")\n#ggplot(data=check_data_lv,aes(x=value,fill=variable,color=variable)) + geom_density(alpha =0.1) +\n#  facet_grid(rows=vars(variable))\n\n\ncheck_data_all<- rbind.data.frame(check_data_pv,check_data_mv,check_data_lv)\nggplot(data=check_data_all,aes(x=factor(0),y=value,fill=variable,color=variable)) +\n  geom_violin(alpha =0.1) +\n  facet_grid(cols=vars(variable))\n\n#INTENTEMOS NO QUITANDO GENES... QUEDÉMONOS CON LOS 4267\n\n\n\n\n\n\n\n\n######### ESTANDARIZACIÓN VSN ##########\n\n\n#meanSdPlot(as.matrix(datos),ranks = T)\n#Hay un poco de sobredispersión\ndatos1 <- justvsn(as.matrix(datos))\n#meanSdPlot(datos1,ranks = T)\n#Listo el pollo\ndatos1 %<>% as.data.frame()\n\n\n\n\n\n\n\n###### EXPORTAR DATOS ########\n\ndatos <- datos1\nsaveobj(\"datos\")\n\n#cols <- c( \"ALIAS\")\n#ensids <- keys(ecoli2.db)\n#correspondencia <- AnnotationDbi::select(ecoli2.db, keys=ensids, columns=cols)\n\n\n#sum(is.na(Ecoli_data))\n",
    "created" : 1540581812765.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "388901604",
    "id" : "8EF786C5",
    "lastKnownWriteTime" : 1541018398,
    "last_content_update" : 1541018398563,
    "path" : "~/Estadística Genómica/Trabajo/clean.R",
    "project_path" : "clean.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}